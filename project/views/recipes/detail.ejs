<%- include('../partials/header') %>
<%- include('../partials/navbar', { user: user }) %>

<div class="container">
  <div class="recipe-detail">
    <div class="recipe-detail-header">
      <h1><%= recipe.title %></h1>
      <span class="recipe-category-badge"><%= recipe.category %></span>
    </div>

    <div class="recipe-info">
      <div class="info-item">
        <span class="info-label">ğŸ‘¨â€ğŸ³ Author:</span>
        <span><%= recipe.author.username %></span>
      </div>
      <div class="info-item">
        <span class="info-label">â±ï¸ Cooking Time:</span>
        <span><%= recipe.cookingTime %> minutes</span>
      </div>
      <div class="info-item">
        <span class="info-label">ğŸ“Š Difficulty:</span>
        <span><%= recipe.difficulty %></span>
      </div>
    </div>

    <div class="recipe-section">
      <h2>ğŸ“ Description</h2>
      <p><%= recipe.description %></p>
    </div>

    <div class="recipe-section">
      <h2>ğŸ¥˜ Ingredients</h2>
      <ul class="ingredients-list">
        <% recipe.ingredients.forEach(ingredient => { %>
          <li><%= ingredient %></li>
        <% }) %>
      </ul>
    </div>

    <div class="recipe-section">
      <h2>ğŸ‘¨â€ğŸ³ Instructions</h2>
      <p class="instructions-text"><%= recipe.instructions %></p>
    </div>

    <% if (user && (recipe.author._id.toString() === user._id.toString() || user.role === 'admin')) { %>
      <div class="recipe-actions-detail">
        <a href="/recipes/<%= recipe._id %>/edit" class="btn btn-edit">Edit Recipe</a>
        <form action="/recipes/<%= recipe._id %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this recipe?');">
          <button type="submit" class="btn btn-delete">Delete Recipe</button>
        </form>
      </div>
    <% } %>

    <div class="comments-section">
      <h2>ğŸ’¬ Comments & Reviews</h2>

      <form action="/recipes/<%= recipe._id %>/comments" method="POST" class="comment-form">
        <div class="form-group">
          <label for="rating">Rating</label>
          <select id="rating" name="rating" required>
            <option value="5">â­â­â­â­â­ Excellent</option>
            <option value="4">â­â­â­â­ Good</option>
            <option value="3">â­â­â­ Average</option>
            <option value="2">â­â­ Below Average</option>
            <option value="1">â­ Poor</option>
          </select>
        </div>

        <div class="form-group">
          <label for="content">Your Comment</label>
          <textarea id="content" name="content" required rows="3" placeholder="Share your thoughts about this recipe"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Add Comment</button>
      </form>

      <div class="comments-list">
        <% if (comments.length === 0) { %>
          <p class="no-comments">No comments yet. Be the first to comment!</p>
        <% } else { %>
          <% comments.forEach(comment => { %>
            <div class="comment-card">
              <div class="comment-header">
                <span class="comment-author">ğŸ‘¤ <%= comment.author.username %></span>
                <span class="comment-rating">
                  <% for(let i = 0; i < comment.rating; i++) { %>â­<% } %>
                </span>
              </div>
              <p class="comment-content"><%= comment.content %></p>
              <small class="comment-date"><%= new Date(comment.createdAt).toLocaleDateString() %></small>
            </div>
          <% }) %>
        <% } %>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
